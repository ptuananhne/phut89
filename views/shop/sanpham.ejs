<%- include('../includes/head.ejs') %>

<div class="breadcrumbs">
    <a href="/">Trang chủ</a><span>&gt;</span>
    <% if (product.category_name) { %>
        <a href="/danh-muc/<%= product.category_slug %>"><%= product.category_name %></a><span>&gt;</span>
    <% } %>
    <span class="active"><%= product.name %></span>
</div>

<div class="product-detail-layout">
    <div class="product-gallery">
        <div class="main-image">
            <img id="mainProductImage" src="<%= product.image_url || 'https://placehold.co/600x600/f1f1f1/333?text=No+Image' %>" alt="<%= product.name %>">
        </div>
        <% if (images && images.length > 1) { %>
            <div class="thumbnail-images">
                <% images.forEach((image, index) => { %>
                    <img src="<%= image.image_url %>" alt="Thumbnail <%= index + 1 %>" class="<%= index === 0 ? 'active' : '' %>" data-full-src="<%= image.image_url %>">
                <% }) %>
            </div>
        <% } %>
    </div>

    <div class="product-info">
        <h1 class="product-title"><%= product.name %></h1>
        <div class="price-box">
            <span class="sale-price"><%= new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(product.price) %></span>
            <!-- Logic cho giá gốc sẽ được thêm sau -->
        </div>
        <p><strong>Tình trạng:</strong> <span class="stock-status in-stock">Còn hàng</span></p>
        <% if (product.brand_name) { %>
            <p><strong>Thương hiệu:</strong> <%= product.brand_name %></p>
        <% } %>
    </div>
</div>

<div class="contact-buy">
    <div class="contact-actions">
        <a href="https://zalo.me/0845115765" target="_blank" class="btn-contact zalo">
            <i class="fa-solid fa-comment-dots"></i>
            <div class="text"><span>Chat qua Zalo</span><small>Hỗ trợ nhanh</small></div>
        </a>
        <a href="https://m.me/Phut89iPhone" target="_blank" class="btn-contact messenger">
            <i class="fab fa-facebook-messenger"></i>
            <div class="text"><span>Chat qua Messenger</span><small>Tư vấn 24/7</small></div>
        </a>
        <a href="tel:0845115765" class="btn-contact btn-call">
            <i class="fas fa-phone-alt"></i>
            <div class="text"><span>Gọi 0845.115.765</span><small>Giải đáp trực tiếp</small></div>
        </a>
    </div>

    <div class="promo-info">
        <p>• Hỗ trợ THU CŨ - ĐỔI MỚI trợ giá lên đến 2 triệu.</p>
        <p>• Hỗ trợ GÓP đưa trước 0 đồng, phí lên đời máy mới.</p>
        <p>• Mua Online Freeship + giảm thêm + giao nhanh tận nhà.</p>
        <p>• Bảo hành 1 ĐỔI 1 lên đến 6 tháng với máy cũ.</p>
    </div>
</div>

<div class="product-tabs">
    <div class="tab-headers">
        <button class="tab-header active" data-tab="description">Mô Tả Sản Phẩm</button>
        <button class="tab-header" data-tab="specs">Thông Số Kỹ Thuật</button>
    </div>
    <div class="tab-content active" id="description">
        <%- product.description || '<p>Chưa có mô tả chi tiết cho sản phẩm này.</p>' %>
    </div>
    <div class="tab-content" id="specs">
        <% if(attributes && attributes.length > 0) { %>
        <table>
            <tbody>
                <% attributes.forEach(attr => { %>
                <tr>
                    <th><%= attr.attr_name %></th>
                    <td><%= attr.attr_value %></td>
                </tr>
                <% }) %>
            </tbody>
        </table>
        <% } else { %>
            <p>Chưa có thông số kỹ thuật cho sản phẩm này.</p>
        <% } %>
    </div>
</div>

<% if(relatedProducts && relatedProducts.length > 0) { %>
<section class="category-showcase" style="margin-top: 2rem;">
    <h2 class="section-title">Sản phẩm liên quan</h2>
    <div class="product-grid">
        <% relatedProducts.forEach(prod => { %>
            <%- include('../includes/product-card.ejs', {product: prod}) %>
        <% }) %>
    </div>
</section>
<% } %>

<%- include('../includes/footer.ejs') %>
<%- include('../includes/end.ejs') %>
